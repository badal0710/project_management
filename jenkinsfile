import hudson.plugins.emailext.*
pipeline{
    agent any 
    stages {  
        stage('Git Checkout'){    
            steps{       
                script{          
                    git branch: 'dev', url: 'https://github.com/badal0710/project_management.git'
                }
            }
        }
        stage('UNIT testing'){   
            steps{
                script{
                    bat 'git checkout dev & mvn test'
                }
            }
        }
        stage('Integration testing'){
            steps{
                script{  
                    bat 'git checkout dev & mvn verify -DskipUnitTests'
                }
            }
        }
        stage('Maven build'){
            steps{
                script{  
                    bat 'git checkout dev & mvn clean install'
                }
            }
        }
        stage('Static code analysis'){
            steps{
                script{  
                    withSonarQubeEnv(credentialsId: 'jenkins-sonarqube-integration-by-sonar-global-token') { 
                        bat 'git checkout dev & mvn clean package sonar:sonar'
                    }
                }
            }
        }
        stage('Quality Gate Status'){
            steps{
               script{      
                    waitForQualityGate abortPipeline: false
                }
            }
        }
    } 
    post {
        failure {
            emailext (
                to: 'manojkapure100@gmail.com',
                subject: "Pipeline Failed: ${currentBuild.fullDisplayName}",
                body: '''<p>The pipeline has failed.</p>
                         <p>Build Number: ${currentBuild.number}</p>
                         <p>Build Status: ${currentBuild.result}</p>
                         <p>Build URL: ${env.BUILD_URL}</p>''',
                mimeType: 'text/html'
            )
        }
    }  
}